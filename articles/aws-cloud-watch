---
title: "AWS Cloud Watch"
emoji: "🔥"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["AWS", "CloudWatch"]
published: false
---

https://biz.nuro.jp/column/aws-mama-006/

## CloudWatchとは？
「CloudWatchは、AWSが提供する「フルマネージド運用監視サービス」で、AWSの各種リソースを監視してくれるもの」
つまり、下記ができるサービス。

	・セットアップ不要で使えて
	・異常な状態を検知して、自動で復旧までしてくれて
	・メトリクスに応じてアラート通知や、アクションを設定できる

## メトリクスとは？
監視対象の変数：つまり何を監視するかの設定
※EC2やEBSなど、いろんなサービスを監視できるそうです。

## CloudWatchのサービス3つ
・CloudWatch
　：リソースを監視する
	→CPUやメモリなどの複数項目をグラフ化してダッシュボードを作れる。
	→よく使うものは標準メトリクスとして用意されている。
	→クレジット（利用料金）も監視できる。
	→監視する他に、リソースの状況に応じて、メールを送ったり、再起動したり、AutoScalingしたりのアクションができる。

・CloudWatch Logs
　：ログを集めて監視する
	→AmazonLinux、RedHat、Windowsなどに対応し、
		インスタンスにエージェントを入れることで各種ログを取得できる。
	→OSに加えて、アプリケーションのログも対応していて、キーワードでアラート通知させることも可能。
	→つまり「アプリケーションやOSがエラーログ吐いたら管理者のメールに通知」が実現できる。

・CloudWatch Events	：APIのイベントをトリガーに何らかのアクションを実行することができる。
	→AWSはさまざまな処理をAPIで実行しているので、例えばEC2インスタンスの起動停止を実行したりできる。
	→インスタンスのterminate(削除)でアラート通知。
	→コンソールに特定のユーザーがサインインした時にアラート通知。など
	→トリガーになるイベントはそれ以外にもEC2ステータス、スケジュールなど多数用意あり。
	→Lambda、SQS、SNSなどと連携可能。

## 既存の監視システム＜CloudWatchの理由
この疑問についてもセッションで答えがありました。
要約すると「CloudWatchはAWS用に作ったんだから、AWS監視に使いやすいのだ」ということ。
こう書くと「なにを当たり前なことを…」感が漂いますが、もちろんちゃんと理由があります。

まず、CloudWatchはPolling型ではなく、Push型であること。
これまでの監視ツールはあらかじめ決まった対象にひとつずつ問い合わせして回るPolling型が一般的。
となると、対象が追加になったら監視サーバに設定する必要があります。
これはAWSで負荷に応じてオートスケールする環境だと無理が出てきます。
勝手に増えたインスタンスを、いつ誰が監視対象に加えるのか…。
がんばればできなくもないようですが、CloudWatchはPush型なので、
監視対象が増えたらその対象が勝手に通知を送ってくるようになるんだそうです。
それはよさげです。

2つ目は、AWSのマネージドサービスにも対応していること。
従来型監視ツールはまずサーバがあり、その下のCPUやメモリなどを監視するイメージですが、
AWSにはサーバが“ない”マネージドサービスも多くあります。
これらのサービスは、サーバありきの従来環境とは監視するポイントも監視方法も大きく異なります。
なんの項目を、どう監視するのか、ということから考えて、既存のツールに対応させるのはハードルが高いでしょう。
もちろんCloudWatchなら、40以上のマネージドサービスに対応し、ほかのものと同じように監視ができます。

さらにはAWSのサービスをフル活用できるのもメリットらしく、
「CloudWatch Logsなら、S3にログをエクスポートし、Hadoopで分析したり、
Kinesisを使ったり」もできるということ！ほう！どうやらすごいらしい！

詳しくはまたこれからの課題が増えた感しかないですが、
ログの分析がAWSのサービス使うと簡単にできるってことで、
今回はそっとしておきたいと思います。

あ、月額料金が一定額を超えたら通知してくれる、
というのはAWSならではっぽくて、便利そうだなと思いました。
これは従来の監視ツールにはなかなかない項目ですし。


## まとめ
というわけでCloudWatchについて紹介してきましたが、
できそうなことは分かったけど、
これを実際使いこなせるかというと甚だ不安というのが正直なところです。
が！安心してください！

ソニーネットワークコミュニケーションズのマネージドクラウド with AWSでは独自の
管理ツール「クラウドポータル」を提供していまして、これを使うとCloudWatchの使い方がイマイチ分からん、
という方でも簡単にAWSの監視ができちゃいます。
CPU使用率とディスク使用率をチェックして8割超えたらアラートメールとか、簡単に設定できます。
CloudWatch Logsを使ったアプリケーションのログ監視とかも割と簡単にできちゃいます。
